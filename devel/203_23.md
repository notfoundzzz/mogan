# 203_23 修复 LaTeX 导入分段函数排版错位

## 如何测试

1. 打开 Mogan，新建空白文档。  
2. 进入数学模式，导入以下公式：

```latex
f(x)=\left\{\begin{aligned}
-x^{2}+1&\quad x\neq0\\
0&\quad x=0
\end{aligned}\right.
```

3. 观察渲染结果：
   - 左大括号应覆盖两行分段内容；
   - 两行分段内容应按 `&` 对齐；
   - `f(x)` 与分段函数整体应垂直居中对齐；
   - `=` 不应被错误推到最右侧。

测试文档：`TeXmacs/tests/tmu/203_23.tmu`

## What

- 修复了 `aligned/alignedat` 在 LaTeX 导入流程中的解析落点。  
- 将其在分段函数场景中的导入目标统一为行内表格语义（`tabular*`），避免 display 级布局造成基线错位。  
- 补全了 `aligned/alignedat` 的 begin/end 匹配路径，确保环境可被完整折叠成单一排版块。

## Why

- 之前 `\left\{...\right.` 包裹 `aligned` 时，`aligned` 未稳定落入行内对齐块，导致：
  - 左大括号与右侧内容未形成整体；
  - `&` 对齐信息泄漏到外层；
  - 视觉上出现整体下沉、`f(x)` 垂直对齐异常。

## How

- 在 `src/Plugins/Tex/fromtex_post.cpp` 的 `parse_pmatrix/finalize_pmatrix` 中增加 `aligned/aligned*/alignedat/alignedat*` 分支。  
- 对 `alignedat` 参数做防御处理（参数是列对数，不按 array 列格式串解析）。  
- 在以下 DRD 文件中补齐 `begin-aligned(*)`、`begin-alignedat(*)` 的数学环境识别：
  - `TeXmacs/progs/convert/latex/latex-command-drd.scm`
  - `TeXmacs/plugins/latex/progs/convert/latex/latex-command-drd.scm`

## 影响范围与风险

- 影响范围：LaTeX 导入时涉及 `aligned/alignedat` 的数学表达式。  
- 风险：极少数依赖旧导入行为的公式，视觉细节可能变化。整体方向是更接近标准 LaTeX 排版。

